<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microcom Creative Ink</title>
  <link rel="icon" href="Microcom.ico" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    img {
      -webkit-user-drag: none;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }
    .zoom-container {
      overflow: hidden;
      border-radius: 0.75rem;
      max-height: 400px;
    }
    .zoom-img {
      transition: transform 0.2s ease;
      cursor: zoom-in;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
</head>
<body class="bg-black flex items-center justify-center min-h-screen text-white">
  <div class="bg-gray-900 shadow-lg rounded-2xl p-6 w-full max-w-md">
    <h1 class="text-2xl font-bold mb-4 text-center text-white">Microcom T-Shirts</h1>
    
    <div class="zoom-container w-full mb-4">
      <img id="imagenPlayera" src="tshirtwhite.png" alt="Playera" class="zoom-img rounded-xl shadow-md">
    </div>

    <div class="space-y-4">
      <label class="block">
        <span class="font-semibold text-white">Nombre</span>
        <input type="text" id="nombre" class="w-full mt-1 p-2 border rounded-lg bg-gray-800 text-white" placeholder="Tu nombre" required>
      </label>

      <!-- Cat√°logo -->
      <div>
        <span class="font-semibold text-white">Dise√±o por Marca</span>
        <div class="mt-2 space-y-2">
          <!-- Marca: Tommy Hilfiger -->
          <details class="bg-gray-800 rounded-lg p-2">
            <summary class="cursor-pointer font-bold">Tommy Hilfiger</summary>
            <!-- Subcategor√≠a Flags -->
            <details class="ml-4 bg-gray-700 rounded-lg p-2 mt-2 subcategoria">
              <summary class="cursor-pointer font-semibold">Flags</summary>
              <div class="grid grid-cols-2 gap-4 mt-2 text-center">
                <div>
                  <img src="https://imgur.com/DNGCALa.png" 
                       alt="Tommy Hilfiger Flags Negra" 
                       class="dise√±o-opcion cursor-pointer border-2 border-transparent rounded-lg hover:border-blue-500"
                       data-dise√±o="Tommy Hilfiger Flags"
                       data-texto="Negra">
                  <p class="mt-1 text-sm">Tommy Hilfiger Flags (Negra)</p>
                </div>
                <div>
                  <img src="https://imgur.com/LXliil9.png" 
                       alt="Tommy Hilfiger Flags Blanca" 
                       class="dise√±o-opcion cursor-pointer border-2 border-transparent rounded-lg hover:border-blue-500"
                       data-dise√±o="Tommy Hilfiger Flags"
                       data-texto="Blanca">
                  <p class="mt-1 text-sm">Tommy Hilfiger Flags (Blanca)</p>
                </div>
                <div>
                  <img src="https://imgur.com/Zqpt6US.png" 
                       alt="Tommy Hilfiger Flags Gris" 
                       class="dise√±o-opcion cursor-pointer border-2 border-transparent rounded-lg hover:border-blue-500"
                       data-dise√±o="Tommy Hilfiger Flags"
                       data-texto="Gris">
                  <p class="mt-1 text-sm">Tommy Hilfiger Flags (Gris)</p>
                </div>
                <div>
                  <img src="https://imgur.com/vNzQEjy.png" 
                       alt="Tommy Hilfiger Flags Roja" 
                       class="dise√±o-opcion cursor-pointer border-2 border-transparent rounded-lg hover:border-blue-500"
                       data-dise√±o="Tommy Hilfiger Flags"
                       data-texto="Roja">
                  <p class="mt-1 text-sm">Tommy Hilfiger Flags (Roja)</p>
                </div>
              </div>
            </details>
          </details>
        </div>
      </div>

      <div class="mt-6">
        <h2 class="text-xl font-semibold mb-2 text-white">üõí Carrito</h2>
        <ul id="carrito" class="space-y-2 text-gray-300"></ul>
      </div>

      <!-- Bot√≥n de enviar -->
      <form id="pedidoForm" class="mt-6"> 
        <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-xl font-bold hover:bg-blue-700 transition"> 
          ‚úÖ Enviar Pedido 
        </button> 
      </form>
    </div>
  </div>

  <script>
    // Bloquear clic derecho en im√°genes
    document.addEventListener("contextmenu", e => {
      if (e.target.tagName.toLowerCase() === "img") e.preventDefault();
    });
    document.querySelectorAll("img").forEach(img => {
      img.setAttribute("draggable", "false");
      img.addEventListener("dragstart", e => e.preventDefault());
    });

    let carrito = [];
    let dise√±oSeleccionado = "";
    let dise√±oTexto = "";
    let imagenLink = "";

    // Selecci√≥n de dise√±o
    document.querySelectorAll(".dise√±o-opcion").forEach(img => {
      img.addEventListener("click", () => {
        document.querySelectorAll(".dise√±o-opcion").forEach(i => i.classList.remove("border-blue-500"));
        img.classList.add("border-blue-500");
        dise√±oSeleccionado = img.dataset.dise√±o;
        dise√±oTexto = img.dataset.texto;
        document.getElementById("imagenPlayera").src = img.src;
        imagenLink = img.src;
      });
    });

    // Inyectar talla y cantidad en cada subcategor√≠a
    document.querySelectorAll(".subcategoria").forEach(sub => {
      const controls = document.createElement("div");
      controls.className = "mt-4 space-y-2";
      controls.innerHTML = `
        <label class="block">
          <span class="font-semibold text-white">Talla</span>
          <select class="talla w-full mt-1 p-2 border rounded-lg bg-gray-800 text-white">
            <option value="">Selecciona una talla</option>
            <option>CH</option>
            <option>MD</option>
            <option>G</option>
            <option>XL</option>
            <option>XXL</option>
          </select>
        </label>
        <label class="block">
          <span class="font-semibold text-white">Cantidad</span>
          <input type="number" value="1" min="1" class="cantidad w-full mt-1 p-2 border rounded-lg bg-gray-800 text-white">
        </label>
        <button type="button" class="agregar bg-green-600 text-white p-2 rounded-xl font-bold hover:bg-green-700 transition w-full">
          ‚ûï Agregar al Carrito
        </button>
      `;
      sub.appendChild(controls);

      controls.querySelector(".agregar").addEventListener("click", () => {
        const nombre = document.getElementById("nombre").value.trim();
        const talla = controls.querySelector(".talla").value;
        const cantidad = parseInt(controls.querySelector(".cantidad").value);

        if (!nombre) {
          alert("Por favor ingresa tu nombre");
          return;
        }
        if (!talla || !dise√±oSeleccionado || cantidad < 1) {
          alert("Por favor selecciona talla, dise√±o y cantidad");
          return;
        }

        carrito.push({
          descripcion: `${cantidad}x | Talla: ${talla}, Dise√±o: ${dise√±oSeleccionado} - ${dise√±oTexto}`,
          cantidad,
          talla,
          dise√±o: dise√±oSeleccionado,
          color: dise√±oTexto,
          imagen: imagenLink
        });

        mostrarCarrito();
      });
    });

    // Mostrar carrito
    function mostrarCarrito() {
      const lista = document.getElementById("carrito");
      lista.innerHTML = "";
      const resumen = {};
      carrito.forEach(item => {
        const key = `${item.dise√±o}||${item.color}||${item.talla}`;
        if (resumen[key]) resumen[key].cantidad += item.cantidad;
        else resumen[key] = {...item};
      });
      Object.values(resumen).forEach(item => {
        const li = document.createElement("li");
        li.className = "flex flex-col bg-gray-800 p-2 rounded-lg";
        li.innerHTML = `<span class="font-semibold text-white">${item.cantidad}x | Talla: ${item.talla}, Dise√±o: ${item.dise√±o} - ${item.color}</span>`;
        lista.appendChild(li);
      });
    }

    // Enviar pedido al servidor
    document.getElementById("pedidoForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value.trim();
      if (!nombre || carrito.length === 0) {
        alert("Por favor ingresa tu nombre y agrega al menos un producto al carrito antes de enviar.");
        return;
      }

      // Resumen simple
      const resumen = {};
      carrito.forEach(item => {
        const key = `${item.dise√±o}||${item.color}||${item.talla}`;
        if (resumen[key]) resumen[key].cantidad += item.cantidad;
        else resumen[key] = {...item};
      });

      // HTML de pedido (lo que ya ten√≠as)
      const pedidoHTML = `
        <div style="background:#0f172a;color:#fff;font-family:'Century Gothic',Arial,sans-serif;padding:20px">
          <h2 style="background:#2563eb;padding:8px;border-radius:5px">Detalle del pedido</h2>
          <table cellpadding="10" cellspacing="0" style="border-collapse:collapse;width:100%;margin-top:20px;background:#1e293b;border-radius:8px">
            <thead style="background:#2563eb;text-align:left">
              <tr><th>Cantidad</th><th>Dise√±o - Color</th><th>Talla</th><th>Imagen</th></tr>
            </thead>
            <tbody>
              ${Object.values(resumen).map(i => `
                <tr>
                  <td>${i.cantidad}</td>
                  <td>${i.dise√±o} - ${i.color}</td>
                  <td>${i.talla}</td>
                  <td><img src="${i.imagen}" width="50"></td>
                </tr>`).join("")}
            </tbody>
          </table>
        </div>
      `;

      try {
        const res = await fetch("guardar_pedido.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            nombre: nombre,
            pedido_html: pedidoHTML
          })
        });

        const data = await res.json();
        if (data.status === "success") {
          window.location.href = "gracias.html";
        } else {
          alert("Error al guardar: " + (data.message || "desconocido"));
        }
      } catch (err) {
        alert("Error de conexi√≥n: " + err.message);
      }
    });
  </script>
</body>
</html>
